"use server";

import { db } from "../../lib/db";

const getUserExploitations = async (userID: number) => {
  try {
    const exploitations = await db.acces_utilisateur.findMany({
      where: {
        id_utilisateur: +userID,
      },
      include: {
        Exploitations: {
          include: {
            Dashboards: true,
          },
        },
      },
    });

    if (exploitations.length === 0) {
      return {
        success: false,
      };
    }

    const formatExploitations = exploitations.map(
      exploitation => exploitation.Exploitations
    );

    return {
      success: true,
      exploitations: formatExploitations,
    };
  } catch (error) {
    console.log("Error :", error);
    return {
      success: false,
      error,
    };
  }
};

export default getUserExploitations;
